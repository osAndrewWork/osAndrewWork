'use strict';

import Hapi from "@hapi/hapi";
import { Server } from "@hapi/hapi";
import jk from "./utils/jkurwa/lib/index.js";

export let server: Server;

export const init = async function(): Promise<Server> {
    server = Hapi.server({
        port: process.env.PORT || 4000,
        host: '0.0.0.0'
    });

    // Routes will go here

    return server;
};

export const start = async function (): Promise<void> {
    console.log(`Listening on ${server.settings.host}:${server.settings.port}`);
    const signature = "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";
    const message = new jk.models.Message(jk.b64_decode(signature));
    const cert = message && message.signer();
    // console.log(cert);
    console.log("info",  message.info.contentInfo.content)
    const content = message.info && message.info.contentInfo && message.info.contentInfo.content;
    console.log(content);
    const ipn = cert.extension && cert.extension.ipn;
    const normalizedIpn = normalizeIpn(ipn);
    const signer = { ...cert.subject, ipn, normalizedIpn };
    const issuer = cert.issuer;
    console.log(signer);
    console.log(issuer);
    return server.start();
};

process.on('unhandledRejection', (err) => {
    console.error("unhandledRejection");
    console.error(err);
    process.exit(1);
});

init().then(() => start());

interface IPN{
    DRFO: string;
    EDRPOU?: string;
}

/**
 * Normalize IPN.
 * @private
 * @param {{DRFO: string, EDRPOU: string}} ipn - IPN object.
 * @returns {{DRFO: string, EDRPOU: string}} Normalized IPN object.
 */
const normalizeIpn = (ipn: {DRFO: string, EDRPOU: string}): IPN | {}  => {
    // Check if not an object.
    if (typeof ipn !== 'object') { return {}; }

    // Define params.
    const { DRFO, EDRPOU } = ipn;
    const normalizedDRFO = normalizeCode(DRFO);
    const normalizedEDRPOU = normalizeCode(EDRPOU);

    // Define and return normalized IPN.
    const normalizedIpn = { DRFO: normalizedDRFO, EDRPOU: normalizedEDRPOU };
    return normalizedIpn;
}

/**
 * Normalize code.
 * @private
 * @param {string} code Code.
 */
const normalizeCode = (code: string) =>{
    // Check if not a string.
    if (typeof code !== 'string') { return; }

    // Filter chars.
    const codeArray = code.toUpperCase().split('');
    const filteredCodeArray = codeArray.filter(v => (v >= '0' && v <= '9') || (v >= 'A' && v <= 'Z') || (v >= 'А' && v <= 'Я'));
    const filteredCode = filteredCodeArray.join('');

    // Check if empty after filters.
    if (filteredCode.length === 0) { return; }

    // Return filtered code.
    return filteredCode;
}